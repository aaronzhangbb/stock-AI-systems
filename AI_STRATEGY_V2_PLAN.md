# AI策略 V2.0 开发方案

> 从"规则驱动"到"数据驱动"的质变  
> 创建日期: 2026-02-08

---

## 一、背景与动机

### V1.0 系统现状
- 基于传统技术指标（MA、RSI、布林带等）构建硬规则策略
- 经 V3 全量回测验证，最佳组合策略: **布林带底部放量+MA60斜率探底** (胜率79%, 夏普4.24)
- **核心问题**: 策略信号稀缺（当前市场0只股票满足条件），且传统指标策略同质化严重，机构早已执行

### V2.0 目标
- 利用 **机器学习/深度学习** 让AI自己从数据中发现规律
- 构建 **非传统指标堆砌** 的原创策略
- 产出: 每天都能给出"AI评分"，而非等待罕见的硬规则触发

---

## 二、硬件条件

| 配置 | 参数 |
|------|------|
| 显卡 | RTX 5080 16GB |
| 数据规模 | 5008只可交易A股 × 3年日K线 |
| 预计模型参数 | 几万~几百万 (仅需2-4GB显存) |

---

## 三、总体架构 (三层金字塔)

```
                    ┌──────────────────┐
   第三层(远期)     │  Transformer     │  ← 时序预测模型
                    │  时序预测引擎     │
                    └────────┬─────────┘
                             │
                    ┌────────┴─────────┐
   第二层(中期)     │  形态聚类引擎     │  ← 无监督学习,发现未知形态
                    │  Pattern Cluster  │
                    └────────┬─────────┘
                             │
                    ┌────────┴─────────┐
   第一层(当前)     │  XGBoost/LightGBM │  ← GPU加速, 特征重要性, AI评分
                    │  梯度提升树引擎    │
                    └──────────────────┘
```

---

## 四、第一层: XGBoost GPU 加速引擎 (当前开发)

### 4.1 特征工程 2.0

**V1特征 (现有12个)**:
- ma30_diff, ma60_diff, ma30_slope, ma60_slope
- rsi6, rsi14, bb_pos, bb_width
- vol_20, vol_ratio, consec_down, dist_low20

**V2新增高阶特征 (~100+个)**:

| 类别 | 特征 | 说明 |
|------|------|------|
| 动量加速度 | 收益率的二阶导数 | 价格变化的"加速度"，而非速度 |
| 多周期动量 | 1/3/5/10/20/60日收益率 | 不同时间窗口的动量信号 |
| 波动率变化 | 波动率的变化率 | "暴风雨前的宁静" |
| 量价背离 | 价格方向 vs 成交量方向 | 主力资金行为痕迹 |
| VWAP偏离 | 成交均价偏离度 | 日内资金流向估算 |
| 价格形态 | 实体/影线比率 | K线微观形态量化 |
| 跨周期关联 | 短期/长期均线偏离比 | 多周期共振信号 |
| 时间特征 | 月份/周几/月内位置 | 日历效应 |
| 相对强度 | 个股涨幅 vs 市场涨幅 | 超额收益能力 |
| 资金流估算 | (H+L+C)/3 * Vol | OBV / MFI 资金流指标 |
| 统计特征 | 偏度/峰度 | 收益分布的形状 |

### 4.2 标签构建

```
label = 1 if 未来5天最高价涨幅 > 3%  else 0
       (即: 买入后5天内至少有一天能获利3%以上)
```

### 4.3 模型训练

- **算法**: XGBoost (tree_method='gpu_hist')
- **训练集**: 2023-02 ~ 2025-06 (约2.5年)
- **验证集**: 2025-07 ~ 2025-12 (6个月)
- **测试集**: 2026-01 ~ 2026-02 (最近1个月,模拟实战)
- **评估指标**: AUC, Precision@top100, 实际收益率
- **特征选择**: SHAP值分析 → 找出AI认为最重要的因子

### 4.4 输出

1. **AI评分 (0-100)**: 每只股票每天一个评分
2. **特征重要性排名**: AI认为哪些因子最能预测涨跌
3. **策略建议**: 每天买入AI评分Top 10-20的股票

---

## 五、第二层: 形态聚类引擎 (中期)

### 5.1 思路
1. 将每只股票过去20天的走势归一化为向量
2. 用 K-Means/DBSCAN 自动聚类为几百种"形态"
3. 标注每种形态的历史胜率
4. 每天扫描: 寻找与"高胜率形态"最相似的股票

### 5.2 优势
- 完全脱离指标体系
- 捕捉市场情绪留下的"指纹"

---

## 六、第三层: Transformer 时序引擎 (远期)

### 6.1 思路
1. 将 [O,H,L,C,V] 视为"Token"
2. 训练类GPT架构的Encoder模型
3. 预测未来5天涨跌概率
4. 利用RTX 5080进行每日滚动训练

### 6.2 技术栈
- PyTorch + Transformer Encoder
- 模型参数 < 100万 (远小于16G显存上限)

---

## 七、最终"超级策略" (集成学习)

```
最终AI评分 = 0.5 × XGBoost评分 + 0.3 × 形态匹配评分 + 0.2 × Transformer评分
            
            │                      │                        │
            │ 擅长:                │ 擅长:                  │ 擅长:
            │ 短期量价关系          │ 底部形态识别            │ 长周期趋势
            │ 资金流异动            │ 市场情绪模式            │ 上下文关联
```

**买入条件**: 最终AI评分 > 90 (约占全市场 1-2%)
**卖出条件**: AI评分 < 50 或 持有超过10天

---

## 八、V1策略保留方案

V1.0 的规则策略（布林带底部放量等）作为"稀有信号捕捉器"保留:
- 当V1和V2同时发出买入信号时 → **最高置信度**
- V1信号单独出现 → 传统策略, 已验证胜率79%
- V2信号单独出现 → AI策略, 每天都有推荐

---

## 九、开发路线图

| 阶段 | 内容 | 预计周期 |
|------|------|---------|
| **阶段1** (当前) | XGBoost + 特征工程2.0 + 特征重要性分析 | 本次开发 |
| **阶段2** | 基于特征重要性, 精选因子训练正式模型 + AI评分系统 | 下一步 |
| **阶段3** | 形态聚类引擎 | 中期 |
| **阶段4** | Transformer引擎 + 集成学习 | 远期 |
| **阶段5** | 每日滚动训练 + 自适应 | 长期 |

---

## 十、技术栈

| 组件 | 技术 |
|------|------|
| 梯度提升树 | XGBoost (GPU版) / LightGBM |
| 特征分析 | SHAP |
| 深度学习 | PyTorch |
| 数据处理 | pandas / numpy |
| 可视化 | plotly / matplotlib |
| GPU加速 | CUDA (RTX 5080) |

---

## 附录A：第一阶段训练结果 (2026-02-08)

### 训练概况

| 指标 | 数值 |
|------|------|
| 总样本数 | 3,198,540 |
| 特征数 | 88 (V2高阶特征) |
| 股票数 | 4,971 |
| 训练集 | 2,480,672 样本 (2023.05~2025.06) |
| 验证集 | 623,649 样本 (2025.07~2025.12) |
| 测试集 | 94,219 样本 (2026.01~2026.02) |
| 预测目标 | 未来5天内最高价涨幅>3% |
| 正样本率 | 53.0% |
| 训练耗时 | 22.5秒 (GPU加速) |
| 最佳迭代 | 14轮 (1000轮早停) |

### 模型效果

| 指标 | 验证集 | 测试集 |
|------|--------|--------|
| AUC | 0.5940 | 0.5938 |
| **Precision@Top50** | **84.0%** | **96.0%** |
| **Precision@Top100** | **83.0%** | **96.0%** |
| Precision@Top200 | 83.0% | 93.5% |
| Precision@Top500 | 83.6% | 89.4% |
| Top10%高置信上涨率 | 64.8% | 74.0% |
| Bottom10%低置信上涨率 | 32.2% | 45.0% |
| **区分度** | **32.6%** | **29.0%** |

### 颠覆性发现：AI认为最重要的因子

> **波动率是预测涨跌的第一要素，远超传统的均线和RSI！**

| 排名 | 特征 | 类别 | 重要性 |
|------|------|------|--------|
| 1 | volatility_20d (20日年化波动率) | 波动率 | 5146.9 |
| 2 | volatility_10d (10日年化波动率) | 波动率 | 1317.6 |
| 3 | volatility_60d (60日年化波动率) | 波动率 | 590.6 |
| 4 | month_pos (月内位置) | 时间效应 | 438.7 |
| 5 | ma60_diff (60日均线偏离) | 均线 | 437.8 |
| 6 | bb_width (布林带宽度) | 布林带 | 345.7 |
| 7 | month (月份) | 时间效应 | 332.2 |
| 8 | ma30_diff (30日均线偏离) | 均线 | 319.6 |
| 9 | volatility_5d (5日波动率) | 波动率 | 307.5 |
| 10 | quarter (季度) | 时间效应 | 297.4 |

### 各类特征贡献度

```
波动率/量    ████████████████████████████████████  43.5%  (13个特征)
均线        ████████████                          14.8%  (15个特征)
动量        ███████                                8.8%  (13个特征)
价格位置    ██████                                 7.1%  (10个特征)
时间效应    █████                                  6.8%  (4个特征)
布林带      ███                                    3.5%  (3个特征)
RSI        ██                                     2.8%  (5个特征)
MACD       ██                                     2.3%  (3个特征)
涨跌统计    ██                                     2.2%  (4个特征)
资金流      ██                                     2.1%  (5个特征)
K线形态     ██                                     1.9%  (5个特征)
KDJ        █                                      1.8%  (3个特征)
其他指标    █                                      1.4%  (2个特征)
统计特征    █                                      1.0%  (2个特征)
```

### 关键洞察

1. **波动率为王**: AI认为波动率贡献了43.5%的预测能力，是所有其他类别总和的2倍。这意味着"高波动=高机会"是A股最核心的数学规律。

2. **时间效应显著**: 月份、月内位置、季度、星期几合计贡献6.8%，说明A股存在明显的日历效应（月初/月末、季末等节点）。

3. **均线仍然有效但非第一**: 均线偏离度(14.8%)是第二大类，但远不如波动率重要。传统策略过于依赖均线。

4. **RSI/KDJ/MACD贡献有限**: 这些"经典"指标合计仅6.9%，说明它们在AI视角下并非核心因子。

5. **测试集精度惊人**: Top50预测精度96%、Top100精度96%，说明AI在筛选"最有可能上涨"的少数股票时非常准确。
